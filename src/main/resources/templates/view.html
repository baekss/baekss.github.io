<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>tutorial</title>
<script type="text/javascript" src="/resource/js/jquery-3.4.1.js"></script>
<script type="text/javascript" src="/resource/js/bootstrap.js"></script>
<script type="text/javascript" src="/resource/js/tutorial.aop.js"></script>
<link rel="stylesheet" href="/resource/css/bootstrap.css" />
<script type="text/javascript" th:inline="javascript">
window.onload = function(){
	var el4 = document.querySelector('#result');
	el4.addEventListener('click', function(e){
		var p = { "id":"L0409"};
		
		var response = fetch('http://api.bss.com:58080/api/product',{
		    method: 'POST', 
		    mode: 'cors',
		    credentials: 'include',
		    headers: {
		      'Content-Type': 'application/json',
		    },
		    referrerPolicy: 'no-referrer',
		    body: JSON.stringify(p)
		});
		
		response.then(data=>{return data.json();})
		.then(result => {console.log(result)})
		.catch(err => {console.log(err)});
	});
//------------------------------------ apply aop ------------------------------------
	var elements = [];
	elements.push(el4);
	var elementScan = new ElementScan(elements);
	
	var trigger = [];
	trigger.push(eventProperties.mouseover);
	trigger.push(eventProperties.click);
	trigger.push(eventProperties.keyup);
	
	var eventAdviceFunctions = {
									before:function(){
										console.log('pre processing');
										var p = { "color" : "red"
												, "size" : 100
												, "keyword" : "text"};
										fetch('http://api.bss.com:58080/api/personalizedData',{
										    method: 'POST', 
										    mode: 'cors',
										    credentials: 'include',
										    headers: {
										      'Content-Type': 'application/json',
										    },
										    referrerPolicy: 'no-referrer',
										    body: JSON.stringify(p)
										});
									},
									after:function(){
										console.log('after processing');
									},
									eFunc:function(exception){
										console.log(exception);
									},
									finallyFunc:function(){
										console.log('finally processing');
									}
								};
	
	
	new AopScan(elementScan, trigger, eventAdviceFunctions);
};
</script>
</head>
<body>
<div class="m-md-4">
<div class="mb-md-4 img-thumbnail">
<p>submit</p>
<input type="button" id="result" value="결과"/>
</div>
</div>
</body>
</html>